<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Admin Feedback Viewer</title>
    <link rel="stylesheet" href="style.css">

</head>
<header>
    <div>Admin Dashboard</div>
    <button class="logout-btn" onclick="logout()">Logout</button>
</header>

<h2>All Feedbacks</h2>

<table id="feedbackTable">
    <thead>
    <tr>
        <th>Feedback ID</th>
        <th>Feedback</th>
        <th>Submitted At</th>
        <th>Action</th>
    </tr>
    </thead>
    <tbody id="feedbackBody">
    <!-- Feedback rows will go here -->
    </tbody>
</table>
<footer>
    <p>Â© 2025 Feedback Portal. All rights reserved.</p>
</footer>
<body>

<div class="feedback-list" id="feedbackList" >
    <!-- Feedback will be loaded here -->
</div>
<script>
    // Fetch all feedback from the backend
    document.addEventListener("DOMContentLoaded", () => {
      fetch("http://localhost:8080/api/feedback/all")
        .then(response => {
          if (!response.ok) {
            throw new Error("Failed to load feedback. Status: " + response.status);
          }
          return response.json();
        })
        .then(data => {
          const feedbackList = document.getElementById("feedbackList");
          feedbackList.innerHTML = "";
        data.forEach((item, index) => {
          const row = document.createElement("tr");

          row.innerHTML = `
            <td>${index + 1}</td>
            <td>${item.message}</td>
            <td>${new Date(item.submittedAt).toLocaleString([], {
              year: 'numeric',
              month: 'short',
              day: 'numeric',
              hour: 'numeric',
              minute: '2-digit',
              hour12: true
            })}</td>
            <td><button class="delete-btn" onclick="deleteFeedback(${item.id})">Delete</button></td>
          `;

          feedbackBody.appendChild(row);
        });
      })
      .catch(error => {
          console.error("Error loading feedback:", error);
          alert("Failed to load feedback.");
        });
    });

    // Delete feedback as admin
    function deleteFeedback(id) {
  const confirmed = confirm("Do you want to delete this feedback?");
  if (!confirmed) return;

  const username = "admin"; // Replace with actual admin username or logic if needed

  fetch(`http://localhost:8080/api/feedback/admin/delete/${id}?username=${username}`, {
    method: "DELETE"
  })
    .then(response => {
      if (!response.ok) {
        throw new Error("Delete failed. Status: " + response.status);
      }
      alert("Feedback deleted.");
      location.reload();
    })
    .catch(error => {
      console.error("Error deleting feedback:", error);
      alert("Error deleting feedback.");
    });
  }
    // Logout button function
    function logout() {
      // You can clear tokens here if using any
      window.location.href = "index.html";
    }


</script>

</body>
</html>
